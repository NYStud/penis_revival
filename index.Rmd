---
title: "Word Penis Dataâ€¦ Again"
author: "Tobi & Lukas"
date: "Rendered `r format(Sys.time(), '%F %H:%M')`"
output:
  html_document:
    toc: true
    toc_float: true
    highlight: tango
    fig_width: 9
    fig_height: 6
    theme: yeti
    code_folding: hide
    lib_dir: "assets"
    self_contained: no
    include:
      after_body: _footer.html
---

```{r setup, include=F}
source("setup.R")

## knitr options
knitr::opts_chunk$set(echo = T, warning = F, message = F, fig.align = "center",
                      fig.path = "assets/plots/")
## ggplot theme
theme_set(theme_readthedown())

## Plotting helpers
plot_caption <- "See http://public.tadaa-data.de/penis_revival"

label_in <- function(x) {paste0(x, "\"")}
label_cm <- function(x) {paste0(x, "cm")}
```

A while ago, [I analyzed the World Penis Data](https://blog.jemu.name/post/2015/08/i-analyzed-some-world-penis-data---because-why-not/), because let's face it, the inclined data enthusiast can't resist a dataset like [this](www.everyoneweb.com/worldpenissize). Sadly, my old code to scrape the table on that page doesn't work anymore, and I have not figured out a new way to get the data, so I have to rely on the data I saved the last time and included in the [tadaadata/loldata](github.com/tadaadata/loldata) package.  

Anyway, long story short: I don't like the look of my old analysis, because that was done in a time before I bothered with ggplot2-prettification. So now we try this again.

## A Look at the Data

First up, let's see where the data is from in the first place.

```{r firstlook}
penis %>%
  group_by(Region) %>%
  tally %>%
  ggplot(aes(x = reorder(Region, n), y = n)) +
  geom_col(alpha = .7) +
  coord_flip() +
  labs(title = "World Penis Data", 
       subtitle = "Number of Studies in Dataset by Region",
       x = "", y = "Number of Studies", caption = plot_caption)

penis %>%
  group_by(Region) %>%
  summarize(n = sum(N)) %>%
  ggplot(aes(x = reorder(Region, n), y = n)) +
  geom_col(alpha = .7) +
  coord_flip() +
  scale_y_continuous(breaks = seq(0, 10^5, 5000), 
                     minor_breaks = seq(0, 10^5, 1000)) +
  labs(title = "World Penis Data", 
       subtitle = "Total N of Studies by Region",
       x = "", y = "Total N", caption = plot_caption)
```

As we can see, our data seems to be most reliable for Europe, South America, multiple Asias and Africa.  
Oddly enough, we have relatively little data on North America, and our data on the Pacific Islands and Central Asia should probably be taken with a grain of salt. However, I have no idea what an appropriate sample size for data like this would be, so I'm mainly eyeballing and trying to sound knowledgable here.

Let's look at the N of the individual datapoints (because every row in our dataset represents the data of a specific study). We'll exclude rows with an N over 200, because that's probably a sufficiently large sample anyway.

```{r firstlook_n}
penis %>%
  filter(N < 200) %>%
  ggplot(data = ., aes(x = N)) +
  geom_histogram(binwidth = 5, alpha = .7) +
  scale_x_continuous(breaks = seq(0, 200, 10),
                     minor_breaks = seq(0, 200, 5)) +
  labs(title = "World Penis Data", subtitle = "Reported N per Study",
       x = "Reported N", y = "Frequency", caption = plot_caption)
```

Seems like we have a few data points based on fairly small samples.  
For the remainder of the analysis, we'll be excluding these data points with an N smaller than 50, because that's the arbitrary judgement of precision I just came up with.

```{r smaller_penis, echo = F}
penis <- penis %>% filter(N >= 50)
```


## Length 

### By State

```{r length_state}
penis %>% 
  gather(key = state, value = length, length_flaccid, length_erect) %>%
  mutate(state = factor(state, 
                        levels = c("length_flaccid", "length_erect"), 
                        labels =  c("Flaccid", "Erect"))) %>%
  {
    ggplot(., aes(x = length, fill = state, color = state)) +
    geom_histogram(binwidth = .5, alpha = .7, position = "dodge") +
    scale_x_continuous(breaks = seq(0, 100, 2), 
                       minor_breaks = seq(0, 100, .5),
                       labels = label_cm,
                       sec.axis = sec_axis(trans = ~./2.54, 
                                           labels = label_in)) +
    labs(title = "World Penis Data", subtitle = "Length by State",
         x = "Length", y = "Frequency", 
         fill = "State", color = "State",
         caption = plot_caption) +
    theme(legend.position = "top")
  }
```

### By State and Region

```{r length_state_region}
penis %>% 
  gather(key = state, value = length, length_flaccid, length_erect) %>%
  mutate(state = factor(state, 
                        levels = c("length_flaccid", "length_erect"), 
                        labels =  c("Flaccid", "Erect"))) %>%
  group_by(Region) %>%
  mutate(order_length = mean(length)) %>%
  {
    ggplot(., aes(x = reorder(Region, order_length), y = length, 
                  fill = state, color = state)) +
    geom_boxplot(alpha = .7) +
    coord_flip() +
    scale_y_continuous(breaks = seq(0, 100, 2), 
                       minor_breaks = seq(0, 100, .5),
                       labels = label_cm,
                       sec.axis = sec_axis(trans = ~./2.54, 
                                           labels = label_in)) +
    labs(title = "World Penis Data", subtitle = "Length by State",
         x = "", y = "Length", fill = "State", color = "State",
         caption = plot_caption) +
    theme(axis.text.y = element_text(size = rel(1.2)),
          legend.position = "top")
  }
```

## Volume

### By State
 
```{r volume_state}
penis %>% 
  gather(key = state, value = volume, volume_flaccid, volume_erect) %>%
  mutate(state = factor(state, 
                        levels = c("volume_flaccid", "volume_erect"), 
                        labels =  c("Flaccid", "Erect"))) %>%
  {
    ggplot(., aes(x = volume, fill = state, color = state)) +
    geom_histogram(binwidth = 5, alpha = .7, position = "dodge") +
    scale_x_continuous(breaks = seq(0, 500, 25), 
                       minor_breaks = seq(0, 500, 5)) +
    labs(title = "World Penis Data", subtitle = "Volume by State",
         x = expression(paste("Volume ", (cm^3))), y = "Frequency", 
         fill = "State", color = "State", caption = plot_caption) +
    theme(legend.position = "top")
  }
```

### By State and Region

```{r volume_state_region}
penis %>% 
  gather(key = state, value = volume, volume_flaccid, volume_erect) %>%
  mutate(state = factor(state, 
                        levels = c("volume_flaccid", "volume_erect"), 
                        labels =  c("Flaccid", "Erect"))) %>%
  group_by(Region) %>%
  mutate(order_volume = mean(volume)) %>%
  {
    ggplot(., aes(x = reorder(Region, order_volume), y = volume, 
                  fill = state, color = state)) +
    geom_boxplot(alpha = .7) +
    coord_flip() +
    scale_y_continuous(breaks = seq(0, 500, 25), 
                       minor_breaks = seq(0, 500, 5)) +
    labs(title = "World Penis Data", subtitle = "Volume by State",
         x = "", y = expression(paste("Volume ", (cm^3))), 
         fill = "State", color = "State", caption = plot_caption) +
    theme(axis.text.y = element_text(size = rel(1.2)),
          legend.position = "top")
  }
```
