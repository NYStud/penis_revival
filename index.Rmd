---
title: "World Penis Data… Again"
author: "Tobi & Lukas"
date: "Rendered `r format(Sys.time(), '%F %H:%M')`"
output:
  html_document:
    toc: true
    toc_float: true
    highlight: tango
    fig_width: 9
    fig_height: 6
    theme: yeti
    code_folding: hide
    lib_dir: "assets"
    self_contained: no
    include:
      after_body: _footer.html
---

```{r setup, include=F}
source("setup.R")
```

A while ago, [I analyzed the World Penis Data](https://blog.jemu.name/post/2015/08/i-analyzed-some-world-penis-data---because-why-not/), because let's face it, the inclined data enthusiast can't resist a dataset like [this](http://www.everyoneweb.com/worldpenissize). Sadly, my old code to scrape the table on that page doesn't work anymore, and I have not figured out a new way to get the data, so I have to rely on the data I saved the last time and included in the [tadaadata/loldata](https://github.com/tadaadata/loldata) package.  

Anyway, long story short: I don't like the look of my old analysis, because that was done in a time before I bothered with ggplot2-prettification. So now we try this again.

## A Look at the Data

First up, let's see where the data is from in the first place.

```{r firstlook}
penis %>%
  group_by(Region) %>%
  tally %>%
  ggplot(aes(x = reorder(Region, n), y = n)) +
  geom_col(alpha = .7) +
  coord_flip() +
  labs(title = "World Penis Data", 
       subtitle = "Number of Studies in Dataset by Region",
       x = "", y = "Number of Studies", caption = plot_caption)

penis %>%
  group_by(Region) %>%
  summarize(n = sum(N)) %>%
  ggplot(aes(x = reorder(Region, n), y = n)) +
  geom_col(alpha = .7) +
  coord_flip() +
  scale_y_continuous(breaks = seq(0, 10^5, 5000), 
                     minor_breaks = seq(0, 10^5, 1000)) +
  labs(title = "World Penis Data", 
       subtitle = "Total N of Studies by Region",
       x = "", y = "Total N", caption = plot_caption)
```

As we can see, our data seems to be most reliable for Europe, South America, multiple Asias and Africa.  
Oddly enough, we have relatively little data on North America, and our data on the Pacific Islands and Central Asia should probably be taken with a grain of salt. However, I have no idea what an appropriate sample size for data like this would be, so I'm mainly eyeballing and trying to sound knowledgable here.

Let's look at the N of the individual datapoints (because every row in our dataset represents the data of a specific study). We'll exclude rows with an N over 200, because that's probably a sufficiently large sample anyway.

```{r firstlook_n}
penis %>%
  filter(N < 200) %>%
  ggplot(data = ., aes(x = N)) +
  geom_histogram(binwidth = 5, alpha = .7) +
  scale_x_continuous(breaks = seq(0, 200, 10),
                     minor_breaks = seq(0, 200, 5)) +
  labs(title = "World Penis Data", subtitle = "Reported N per Study",
       x = "Reported N", y = "Frequency", caption = plot_caption)
```


Seems like we have a few data points based on fairly small samples.  
For the remainder of the analysis, we'll be excluding these data points with an N smaller than 50, because that's the arbitrary judgement of precision I just came up with.

```{r smaller_penis, echo = F}
penis <- penis %>% filter(N >= 50)
```


## Length 

It seems fairly pointless to plot the length of both flaccid and erect states combined, but for completion's sake, let's just get it over with.

```{r length}
penis %>% 
  gather(key = state, value = length, length_flaccid, length_erect) %>%
  mutate(state = factor(state, 
                        levels = c("length_flaccid", "length_erect"), 
                        labels =  c("Flaccid", "Erect"))) %>%
  {
    ggplot(., aes(x = length)) +
    geom_histogram(binwidth = .5, alpha = .7, position = "dodge") +
    scale_x_continuous(breaks = seq(0, 100, 2), 
                       minor_breaks = seq(0, 100, .5),
                       labels = label_cm,
                       sec.axis = sec_axis(trans = ~./2.54, 
                                           labels = label_in)) +
    labs(title = "World Penis Data", subtitle = "Length",
         x = "Length", y = "Frequency", 
         fill = "State", color = "State",
         caption = plot_caption) +
    theme(legend.position = "top")
  }
```


### By State

```{r length_state}
penis %>% 
  gather(key = state, value = length, length_flaccid, length_erect) %>%
  mutate(state = factor(state, 
                        levels = c("length_flaccid", "length_erect"), 
                        labels =  c("Flaccid", "Erect"))) %>%
  {
    ggplot(., aes(x = length, fill = state, color = state)) +
    geom_histogram(binwidth = .5, alpha = .7, position = "dodge") +
    scale_x_continuous(breaks = seq(0, 100, 2), 
                       minor_breaks = seq(0, 100, .5),
                       labels = label_cm,
                       sec.axis = sec_axis(trans = ~./2.54, 
                                           labels = label_in)) +
    scale_fill_brewer(palette = "Paired") +
    scale_color_brewer(palette = "Paired") +
    labs(title = "World Penis Data", subtitle = "Length by State",
         x = "Length", y = "Frequency", 
         fill = "State", color = "State",
         caption = plot_caption) +
    theme(legend.position = "top")
  }
```

#### By State and Region

```{r length_state_region}
penis %>% 
  gather(key = state, value = length, length_flaccid, length_erect) %>%
  mutate(state = factor(state, 
                        levels = c("length_flaccid", "length_erect"), 
                        labels =  c("Flaccid", "Erect"))) %>%
  group_by(Region) %>%
  mutate(order_length = mean(length)) %>%
  {
    ggplot(., aes(x = reorder(Region, order_length), y = length, 
                  fill = state, color = state)) +
    geom_boxplot(alpha = .7) +
    coord_flip() +
    scale_y_continuous(breaks = seq(0, 100, 2), 
                       minor_breaks = seq(0, 100, .5),
                       labels = label_cm,
                       sec.axis = sec_axis(trans = ~./2.54, 
                                           labels = label_in)) +
    scale_fill_brewer(palette = "Paired") +
    scale_color_brewer(palette = "Paired") +
    labs(title = "World Penis Data", subtitle = "Length by State",
         x = "", y = "Length", fill = "State", color = "State",
         caption = plot_caption) +
    theme(axis.text.y = element_text(size = rel(1.2)),
          legend.position = "top")
  }

# CIs
penis_long %>%
  group_by(Region) %>%
  mutate(order_length = mean(length)) %>%
  {
    ggplot(data = ., aes(x = reorder(Region, order_length), y = length, color = state)) +
    stat_summary(fun.data = mean_cl_normal, geom = "errorbar") +
    stat_summary(fun.y = mean, geom = "point", size = 2) +
    coord_flip() +
    scale_y_continuous(breaks = seq(0, 100, 2), 
                       minor_breaks = seq(0, 100, .5),
                       labels = label_cm,
                       sec.axis = sec_axis(trans = ~./2.54, 
                                           labels = label_in)) +
    scale_color_brewer(palette = "Paired") +
    labs(title = "World Penis Data", subtitle = "Length by State (mean with 95% CI)",
         x = "", y = "Length", fill = "State", color = "State",
         caption = plot_caption) +
    theme(axis.text.y = element_text(size = rel(1.2)),
          legend.position = "top")
  }
```

### Growth Factor

I calculated the length-wise growth factor based on $\frac{\text{erect length}}{\text{flaccid length}}$, which reduces the relationship of erect and flaccid length into a single variable.  
Let's look what that's all about.

```{r length_growth}
ggplot(data = penis, aes(x = growth_length)) +
  geom_histogram(binwidth = .05, alpha = .7) +
  labs(title = "World Penis Data", subtitle = "Length-wise growth factor",
         x = "Growth Factor", y = "Frequency",
         caption = plot_caption)
```

Well that seems like it justifies further investigation.

#### By Region

```{r growth_length_regions}
ggplot(data = penis, aes(x = reorder(Region, growth_length), y = growth_length)) +
  stat_summary(fun.data = mean_cl_normal, geom = "errorbar") +
  stat_summary(fun.y = mean, geom = "point", size = 2) +
  coord_flip() +
  scale_y_continuous(breaks = seq(0, 2, .05)) +
  labs(title = "World Penis Data", 
       subtitle = "Length-wise growth factor by region (mean with 95% CI)",
       x = "", y = "Growth Factor",
       caption = plot_caption)
```


## Circumference

As with length, it's probably not really interesting to look at the distribution of penis circumferences regardless of state, but well, we're a thorough bunch.

```{r circumf}
ggplot(penis_long, aes(x = length)) +
geom_histogram(binwidth = .5, alpha = .7, position = "dodge") +
scale_x_continuous(breaks = seq(0, 100, 1), 
                   minor_breaks = seq(0, 100, .5),
                   labels = label_cm,
                   sec.axis = sec_axis(trans = ~./2.54, 
                                       labels = label_in)) +
labs(title = "World Penis Data", subtitle = "Circumference",
     x = "Circumference", y = "Frequency", 
     fill = "State", color = "State",
     caption = plot_caption) +
theme(legend.position = "top")
```


### By State

```{r circumf_state}
ggplot(penis_long, aes(x = length, fill = state, color = state)) +
geom_histogram(binwidth = .5, alpha = .7, position = "dodge") +
scale_x_continuous(breaks = seq(0, 100, 1), 
                   minor_breaks = seq(0, 100, .5),
                   labels = label_cm,
                   sec.axis = sec_axis(trans = ~./2.54, 
                                       labels = label_in)) +
scale_fill_brewer(palette = "Paired") +
scale_color_brewer(palette = "Paired") +
labs(title = "World Penis Data", subtitle = "Circumference by State",
     x = "Circumference", y = "Frequency", 
     fill = "State", color = "State",
     caption = plot_caption) +
theme(legend.position = "top")
```

### By State and Region

```{r circumf_state_region}
penis_long %>%
  group_by(Region) %>%
  mutate(order_circumf = mean(length)) %>%
  {
    ggplot(., aes(x = reorder(Region, order_circumf), y = circumf, 
                  fill = state, color = state)) +
    geom_boxplot(alpha = .7) +
    coord_flip() +
    scale_y_continuous(breaks = seq(0, 100, 2), 
                       minor_breaks = seq(0, 100, .5),
                       labels = label_cm,
                       sec.axis = sec_axis(trans = ~./2.54, 
                                           labels = label_in)) +
    scale_fill_brewer(palette = "Paired") +
    scale_color_brewer(palette = "Paired") +
    labs(title = "World Penis Data", subtitle = "Circumference by State",
         x = "", y = "Circumference", fill = "State", color = "State",
         caption = plot_caption) +
    theme(axis.text.y = element_text(size = rel(1.2)),
          legend.position = "top")
  }

# CIs
penis_long %>%
  group_by(Region) %>%
  mutate(order_circumf = mean(length)) %>%
  {
    ggplot(data = ., aes(x = reorder(Region, order_circumf), y = circumf, color = state)) +
    stat_summary(fun.data = mean_cl_normal, geom = "errorbar") +
    stat_summary(fun.y = mean, geom = "point", size = 2) +
    coord_flip() +
    scale_y_continuous(breaks = seq(0, 100, 1), 
                       minor_breaks = seq(0, 100, .5),
                       labels = label_cm,
                       sec.axis = sec_axis(trans = ~./2.54, 
                                           labels = label_in)) +
    scale_color_brewer(palette = "Paired") +
    labs(title = "World Penis Data", subtitle = "Circumference by State",
         x = "", y = "Circumference", fill = "State", color = "State",
         caption = plot_caption) +
    theme(axis.text.y = element_text(size = rel(1.2)),
          legend.position = "top")
  }
```


## Volume

### By State
 
```{r volume_state}
penis %>% 
  gather(key = state, value = volume, volume_flaccid, volume_erect) %>%
  mutate(state = factor(state, 
                        levels = c("volume_flaccid", "volume_erect"), 
                        labels =  c("Flaccid", "Erect"))) %>%
  {
    ggplot(., aes(x = volume, fill = state, color = state)) +
    geom_histogram(binwidth = 5, alpha = .7, position = "dodge") +
    scale_x_continuous(breaks = seq(0, 500, 25), 
                       minor_breaks = seq(0, 500, 5)) +
    scale_fill_brewer(palette = "Paired") +
    scale_color_brewer(palette = "Paired") +
    labs(title = "World Penis Data", subtitle = "Volume by State",
         x = expression(paste("Volume ", (cm^3))), y = "Frequency", 
         fill = "State", color = "State", caption = plot_caption) +
    theme(legend.position = "top")
  }
```

### By State and Region

```{r volume_state_region}
penis %>% 
  gather(key = state, value = volume, volume_flaccid, volume_erect) %>%
  mutate(state = factor(state, 
                        levels = c("volume_flaccid", "volume_erect"), 
                        labels =  c("Flaccid", "Erect"))) %>%
  group_by(Region) %>%
  mutate(order_volume = mean(volume)) %>%
  {
    ggplot(., aes(x = reorder(Region, order_volume), y = volume, 
                  fill = state, color = state)) +
    geom_boxplot(alpha = .7) +
    coord_flip() +
    scale_y_continuous(breaks = seq(0, 500, 25), 
                       minor_breaks = seq(0, 500, 5)) +
    scale_fill_brewer(palette = "Paired") +
    scale_color_brewer(palette = "Paired") +
    labs(title = "World Penis Data", subtitle = "Volume by State",
         x = "", y = expression(paste("Volume ", (cm^3))), 
         fill = "State", color = "State", caption = plot_caption) +
    theme(axis.text.y = element_text(size = rel(1.2)),
          legend.position = "top")
  }

# CIs
penis_long %>%
  group_by(Region) %>%
  mutate(order_volume = mean(volume)) %>%
  {
    ggplot(., aes(x = reorder(Region, order_volume), y = volume,
                  fill = state, color = state)) +
    stat_summary(fun.data = mean_cl_normal, geom = "errorbar") +
    stat_summary(fun.y = mean, geom = "point", size = 2) +
    coord_flip() +
    scale_y_continuous(breaks = seq(0, 500, 25),
                       minor_breaks = seq(0, 500, 5)) +
    scale_color_brewer(palette = "Paired") +
    labs(title = "World Penis Data", subtitle = "Volume by State",
         x = "", y = expression(paste("Volume ", (cm^3))),
         fill = "State", color = "State", caption = plot_caption) +
    theme(axis.text.y = element_text(size = rel(1.2)),
          legend.position = "top")
  }
```

## Choropletz-Penismap, because why not?

A choropleth map displaying the worldwide distribution of the volume of erect penisses. Enjoy.

```{r choropenis_vol_erect}
data(worldgeojson, package = "highcharter")

idk <- data.frame(q = c(0, exp(1:2)/exp(2)),
                  c = substring(viridis(2+1, option = "D"), 0, 7)) %>% 
  list_parse2()

highchart() %>% 
  hc_add_series_map(worldgeojson, map, value = "volume_erect", joinBy = "iso3",
                    name = "Penis Volume (erect)") %>% 
  hc_title(text = "Erect Penis Volume by Country") %>% 
  hc_tooltip(valueDecimals = 2, valuePrefix = "<b>", valueSuffix = " cm²</b>") %>% 
  hc_colorAxis(stops = idk, min = 80, max = 260) %>% 
  hc_legend(enabled = TRUE) %>% 
  hc_mapNavigation(enabled = TRUE)
```


## Correlations

### Erect Length and Flaccid Length

Seems fairly self-explanatory to suspect a relationship there, so let's see.

```{r corr_length_states}
ggplot(data = penis, aes(x = length_flaccid, y = length_erect)) +
  geom_smooth(method = lm, se = F, color = "gray") +
  geom_point(size = 2) +
  labs(title = "World Penis Data",
       subtitle = "Flaccid by Erect Length",
       x = "Flaccid Length (cm)", y = "Erect Length (cm)",
       caption = plot_caption)
```


Well that looks like a pretty decent linear relationship with some other effect we haven't identified yet.  
Since there's only so much data in this dataset, the only thing we can really do is to look at the effect of different regions.

```{r corr_length_states_regions_mean}
penis %>% 
  group_by(Region) %>%
  summarize(length_flaccid = mean(length_flaccid),
            length_erect   = mean(length_erect)) %>%
  ggplot(data = ., aes(x = length_flaccid, y = length_erect, color = Region)) +
  geom_smooth(method = lm, se = F, color = "gray") +
  geom_point(size = 3, color = "black") +
  geom_point(size = 2) +
  scale_color_brewer(palette = "Paired") +
  labs(title = "World Penis Data",
       subtitle = "Flaccid by Erect Length (averaged by region)",
       x = "Flaccid Length (cm)", y = "Erect Length (cm)",
       caption = plot_caption)
```

That seems… reasonably informative. Let's to that again without the averaging though.

```{r corr_length_states_regions}
ggplot(data = penis, aes(x = length_flaccid, y = length_erect, color = Region)) +
  geom_smooth(method = lm, se = F, color = "gray") +
  geom_point(size = 3, color = "black") +
  geom_point(size = 2) +
  scale_color_brewer(palette = "Paired") +
  labs(title = "World Penis Data",
       subtitle = "Flaccid by Erect Length",
       x = "Flaccid Length (cm)", y = "Erect Length (cm)",
       caption = plot_caption)
```


Well, we've seen enough of that I guess.  
Let's do some math:

```{r corr_length_states_lm}
model <- lm(length_erect ~ length_flaccid, data = penis)

knitr::kable(tidy(model))

knitr::kable(glance(model))
```


So… yeah. There's a perfectly valid linear relationship with a nice big $R^2$ and it basically tells us that the expected size of an erect penis will be roughly 1.4 times the size of the flaccid penis.  
Seems… realistic, I guess?

Lastly, here's a version of the above plot for you to get your hands on:

```{r corr_length_states_plotly}
text <- ~paste0("<b>", Region, "</b>",
               "<br /><b>Country:</b> ", Country,
               "<br /><b>N</b> = ", N,
               "<br /><b>Source:</b> ", Source)

plot_ly(data = penis, x = ~length_flaccid, y = ~length_erect, colors = "Paired") %>%
  add_markers(color = I("black"), size = I(12), hoverinfo = "none") %>%
  add_markers(color = ~Region, hoverinfo = "text", size = I(10),
              text = text) %>%
  layout(title = "World Penis Data:<br />Erect by Flaccid Length",
         xaxis = list(title = "Flaccid Length (cm)"), 
         yaxis = list(title = "Erect Length (cm)"),
         paper_bgcolor = "#ffffff", plot_bgcolor = "#ffffff", hovermode = "closest",
         showlegend = F)

rm(text)
```

